<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>

<head>


<title>cs152 Project Phase 3: Code Generation</title>
</head>

<body>

<h2><u>cs152 Project Phase 3: Code Generation</u></h2>

<b><i><font size="+1">Due Date: </font></i>Wednesday, March 11, 2009 at
11:59p.m.</b>
<br>
<br>
<b><i><font size="+1">Grade Weight: </font></i>15% of total course grade</b><br>
<br>
<b>The project must be completed individually; you are not allowed to
collaborate with your classmates. Any collaboration or code sharing 
(including code submitted in past quarters) will be
considered a violation of academic integrity and dealt with as set
forth in the <a href="../index.html#integrity">academic integrity
policy</a>.

</b>
<br>


<h3>Overview</h3>

<p>
In the previous phases of the class project, you used the <i>flex</i> and <i>bison</i>
tools to create a lexical analyzer and a parser for the "MINI-L" programming language.
In this phase of the class project, you will take a syntactically-correct MINI-L
program (a program that can be parsed without any syntax errors), verify that it has
no semantic errors, and then generate its corresponding intermediate code.
The generated code can then be executed (using a tool we will provide)
to run the compiled MINI-L program.  
</p>

<p>
[<i>The MINI-L source-code language is described in detail <a href="mini_l.html">here</a></i> (this is the same as for the prior project phases).]
</p>

<p>
You should perform <i>one-pass</i> code generation and directly output the generated code.
There is no need to build/traverse a syntax tree.  However, you will need to
maintain a symbol table during code generation.
</p>

<p>
The intermediate code you will generate is called "MIL" code.  We will provide you with an
interpreter called <code>mil_run</code> that can be used to execute the MIL code.
</p>

<p>
[<i>The MIL intermediate code representation is described in detail <a href="mil.html">here</a>.</i>] <br>
[<i>Download the <code>mil_run</code> MIL interpreter <a href="https://moodle.cs.ucr.edu/moodle/mod/resource/view.php?id=5894">here</a>.</i>]
</p>

<p>
The output of your code generator will be a file containing the generated MIL code.
If any semantic errors are encountered by the code generator, then appropriate
error messages should be emitted and no other output should be produced.
</p>

<p>
[<i>The required output format for your code generator is described <a href="code_output_format.html">here</a>.</i>]
</p>


<hr>

<h3>The <code>mil_run</code> MIL interpreter</h3>

<p>
We are providing an interpreter for MIL intermediate code (<a href="https://moodle.cs.ucr.edu/moodle/mod/resource/view.php?id=5894">mil_run</a>), which can be
used to execute the MIL code generated by your code generator.  The <code>mil_run</code>
interpreter requires an input file to be specified that contains the MIL code that should be executed.  For
example, if you have MIL code contained in a file called <code>mil_code.mil</code>, then
you can execute the MIL code with the following command:
</p>

<p>
<code>mil_run mil_code.mil</code>
</p>

<p>
If the MIL code itself requires some input data, this input data can be written to a file
and then redirected to the executing MIL code.  For example, if the input values are
written to a text file called <code>input.txt</code>, then it can be passed to the
executing MIL program as follows:
</p>

<p>
<code>mil_run mil_code.mil < input.txt</code>
</p>

<p>
The <code>mil_run</code> interpreter will generate a file called <code>milRun.stat</code>
that contains some statistics about the MIL code that was just executed.  You may
ignore this file.
</p>

<p>
<code>mil_run</code> makes the following assumptions.
</p>

<ol>
<li>Each line in the MIL file contains at most one MIL instruction
<li>Each line is at most 254 characters long
<li>All variables are defined before they are used
</ol>

<p>
You must ensure that your generated MIL code meets the above three requirements.
</p>

<p>
<code>mil_run</code> is a Linux executable and can be run on <i>bass</i>.
</p>

<hr>

<h3>Detailed Requirements</h3>

The following tasks will need to be performed to complete this phase of the project.

<ol>
<li> You will need to modify your <i>bison</i> specification file from the previous
phase of the class project so that it no longer outputs the list of productions taken
during parsing.
<li> Implement the code generator.  This will most likely require some enhancements to
your <i>bison</i> specification file.  You may also want to create additional implementation
files.  The requirements for your implementation are as follows.

<ol type="a">
<li> You do not need to do anything special to handle <i>lexical</i> or <i>syntax</i> errors in this
phase of the class project.  If any lexical or syntax errors are encountered, your compiler
should emit appropriate error message(s) and terminate the same way as was done in previous phases.
<li> You need to check for <i>semantic</i> errors in the inputted MINI-L program.
During code generation, if any semantic errors are encountered, then appropriate
error messages should be emitted and no other output should be produced
(i.e., no code should be generated).
<li> If no semantic errors are encountered, then the appropriate MIL intermediate code should be
generated and written to a file called <code>XXXX.mil</code>, where <code>XXXX</code>
is the name of the MINI-L program as specified in the <i>program declaration</i>
statement within the MINI-L source code.
<li> When generating the intermediate code, be careful that you do not accidentally create a temporary
variable with the same name as one of the variables specified in the original MINI-L program.
</ol>

<li> Compile everything together into a single executable.  The particular commands
needed to compile your code generator will depend on the implementation files you
create.
<li> Use the <code>mil_run</code> MIL interpreter to test your implementation.
For each program written in MINI-L source code, compile it down to MIL code using
your implementation.  Then invoke the MIL code using <code>mil_run</code> to verify
that the compiled program behaves as expected.<br>
</ol>

<hr>

<h3>A Note about Runtime Errors</h3>

<p>
There are some errors that cannot always be captured at compile-time and may only
happen at run-time.  These errors include those such as array index out-of-bounds
errors, and division by zero.  Your implementation need not handle these errors.
You may assume that when we grade your programs, we will not use any MINI-L programs
that would lead to run-time errors.  Note also that the <code>mil_run</code> MIL interpreter
we are providing may have unexpected behavior if you try to run it on a program
that can lead to run-time problems (such as an out-of-bounds array access).
Thus, when you are testing your implementation, try to make sure your MINI-L programs
will not cause any run-time errors.
</p>

<hr>

<h3>Example Usage</h3>

<p>
Suppose your code generator is in the executable named <code>my_compiler</code>.  Then for
the MINI-L program <a href="primes.min">primes.min</a> (which is syntactically and semantically
correct), your code generator should be invoked as follows:
</p>

<p>
<code>cat primes.min | my_compiler</code>
</p>

<p>
The file <a href="primes.mil">primes.mil</a> should then be created and should contain the generated MIL code
(it is okay if your generated code looks slightly different, but it should have the same behavior when executed).
Next, you can test your generated code using the <code>mil_run</code> MIL interpreter to ensure that
it behaves as expected.  Suppose we want to run the compiled <code>primes</code> program with input "100":
</p>

<code>
echo 100 > input.txt <br>
mil_run primes.mil < input.txt
</code>

<p>
When the compiled <code>primes</code> program is executed with the above input "100", then all
the prime numbers up to 100 are printed to the screen:
</p>

<code>
2<br>
3<br>
5<br>
7<br>
11<br>
13<br>
17<br>
19<br>
23<br>
29<br>
31<br>
37<br>
41<br>
43<br>
47<br>
53<br>
59<br>
61<br>
67<br>
71<br>
73<br>
79<br>
83<br>
89<br>
97
</code>

<hr>

<h3>Submission instructions</h3>

<p>
Submit via <a href="https://moodle.cs.ucr.edu/moodle/course/view.php?id=223">Moodle</a>.
Turn in your source code and the Makefile (or a build script) in a .tar.gz
or .zip file. Make sure you can uncompress and compile your submission
on <i>bass</i>, otherwise your score for this project will be 0.

</p>

<hr>

<h3>Extra credit for implementing your project in OCaml</h3>

<p>Similar to projects 1 and 2, if you implement this project in <a
href="http://caml.inria.fr/ocaml/index.en.html">Objective Caml</a> (an
ML variant that supports functional, object-oriented, and imperative programming)
you will receive 10% extra credit on this project's score.</p>

<p>
We have installed  
OCaml on <i>bass</i>. It comes with its own parser generator,
<i>ocamlyacc</i> (similar to <i>bison</i>), and an impressive
array of libraries.
</p>

<p>If you are having technical difficulties with OCaml, contact the
instructor. TA's do not have time and resources to help students with
the OCaml implementation.
</p>


<h4>OCaml resources</h4>
<ul>
<li><a href="http://caml.inria.fr/pub/docs/manual-ocaml/index.html">The OCaml manual</a>
<li>Jason Hickey's <a href="http://mojave.caltech.edu/jyh/">book</a>
</ul>


<h4>Implementing the project in a functional language other than OCaml</h4>
This might be possible, but check with the instructor first.

<hr>

<script language="JavaScript">
          <!---//hide script from old browsers
          var theDate = new Date(document.lastModified);
	  var theLocalDate = theDate.toLocaleString();
          document.write( "<i>Last updated: "+ theLocalDate +"</i>");
          //end hiding contents --->
</script> 





</body>

</html>
